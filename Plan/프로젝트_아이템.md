__디아블로 4 'Loot Reborn' 아키텍처 기반의 마인크래프트 RPG 서버 시스템 설계 및 구현 보고서__

__1. 서론: ARPG 시스템의 마인크래프트 이식과 기술적 과제__

현대 Action RPG(ARPG)의 정점 중 하나인 디아블로 4(Diablo IV)는 시즌 4 'Loot Reborn(전리품의 재탄생)' 업데이트를 기점으로 아이템 체계의 근본적인 변혁을 맞이했습니다. 기존의 복잡하고 조건부적인 속성들을 과감히 축소하고, '담금질(Tempering)'과 '명품화(Masterworking)'라는 결정론적 크래프팅 시스템을 도입함으로써 플레이어에게 명확한 성장 경로를 제시한 이 변화는 마인크래프트 RPG 서버 개발에 있어 매우 중요한 청사진을 제공합니다.<sup>1</sup>

본 보고서는 디아블로 4의 시즌 4 이후 확립된 아이템 로직, 데이터 구조, 그리고 수학적 모델을 심층 분석하여, 이를 자바(Java) 기반의 마인크래프트 서버 환경(Spigot/Paper API)에 이식하기 위한 기술적 가이드라인을 제시하는 것을 목적으로 합니다. 마인크래프트의 기본 전투 시스템은 단순한 선형적 대미지 계산과 방어력 공식을 따르기 때문에, 디아블로 4 특유의 '곱연산 대미지 버킷(Multiplicative Damage Buckets)'과 '비선형 방어 효율(Armor Diminishing Returns)'을 구현하기 위해서는 바닐라 메커니즘을 완전히 대체하는 커스텀 엔진의 설계가 필수적입니다.

따라서 본 보고서는 단순한 게임 기획서가 아닌, 데이터 엔지니어링과 시스템 아키텍처 관점에서 다음의 핵심 영역을 다룹니다:



1. __논리적 도메인(Logical Domain):__ 'Loot Reborn'의 속성 체계와 절차적 생성(Procedural Generation) 알고리즘 분석.
2. __수학적 도메인(Mathematical Domain):__ 대미지 산출 공식, 방어력 캡(Cap), 그리고 저항 시스템의 연산 모델링.
3. __데이터 도메인(Data Domain):__ 마인크래프트 NBT(Named Binary Tag) 및 PersistentDataContainer(PDC)를 활용한 객체 지향적 아이템 저장 구조.
4. __시스템 도메인(Systems Domain):__ 담금질 및 명품화 루프의 상태 머신 설계.


---

__2. 아이템 아키텍처: 위계 구조와 속성 풀의 재정의__

디아블로 4 시즌 4의 핵심은 '베이스 아이템의 단순화'와 '크래프팅을 통한 복잡성 부여'로 요약됩니다. 이는 마인크래프트 서버 개발 시 데이터베이스 스키마를 설계하는 데 있어 중요한 기준점이 됩니다. 아이템이 드랍되는 시점의 데이터(Base State)와 플레이어의 개입으로 변형된 데이터(Forged State)를 명확히 구분해야 하기 때문입니다.

__2.1 아이템 등급과 위력(Item Power)의 상관관계__

서버 내 아이템 생성기는 월드 티어(난이도)에 따라 명확히 구분된 아이템 위력(Item Power)을 부여해야 합니다. 디아블로 4의 데이터에 따르면, 아이템 위력은 단순한 공격력 수치가 아니라 해당 아이템에 부여될 수 있는 속성(Affix)의 범위(Range)를 결정하는 매개변수입니다.<sup>3</sup>

__마인크래프트 서버 적용을 위한 등급 체계:__


<table>
  <tr>
   <td><strong>등급 (Tier)</strong>
   </td>
   <td><strong>디아블로 4 명칭</strong>
   </td>
   <td><strong>마인크래프트 구현 전략</strong>
   </td>
   <td><strong>특징 및 데이터 처리</strong>
   </td>
  </tr>
  <tr>
   <td><strong>일반/매직</strong>
   </td>
   <td>Normal/Magic
   </td>
   <td>기본/초반 장비
   </td>
   <td>크래프팅 재료(분해용)로 주로 활용. 속성 1-2개.
   </td>
  </tr>
  <tr>
   <td><strong>희귀</strong>
   </td>
   <td>Rare
   </td>
   <td>거쳐가는 장비
   </td>
   <td>시즌 4부터 속성 개수가 2개로 축소됨. 담금질 가능 횟수 제한.
   </td>
  </tr>
  <tr>
   <td><strong>전설</strong>
   </td>
   <td>Legendary
   </td>
   <td>핵심 파밍 대상
   </td>
   <td><strong>기본 속성 3개</strong>. 담금질 슬롯 2개 제공. 전설 위상(Aspect) 각인 가능.
   </td>
  </tr>
  <tr>
   <td><strong>고유</strong>
   </td>
   <td>Unique
   </td>
   <td>빌드 전용 장비
   </td>
   <td><strong>고정 속성 4개 + 고유 능력 1개</strong>. 담금질 불가. 명품화 가능.
   </td>
  </tr>
  <tr>
   <td><strong>신화 고유</strong>
   </td>
   <td>Mythic Unique
   </td>
   <td>최상위(Uber) 장비
   </td>
   <td>고정 속성이 최댓값으로 드랍. 유니크 능력 보유.
   </td>
  </tr>
</table>


특히 시즌 4부터 '신성(Sacred)' 아이템은 월드 티어 3에서, '선조(Ancestral)' 아이템은 월드 티어 4에서만 드랍되도록 변경되었습니다.<sup>5</sup> 서버 구현 시, 몬스터의 레벨이나 지역(Region) ID에 따라 드랍 테이블을 엄격히 분리해야 합니다. 선조 아이템은 마인크래프트 서버의 엔드 콘텐츠(레이드, 던전) 보상의 핵심이 되며, 담금질 슬롯 2개를 모두 사용할 수 있는 유일한 등급으로 설정해야 합니다.

__2.2 간소화된 어픽스(Affix) 풀과 데이터 구조__

과거의 "화요일에 피해 증가"와 같은 난해한 조건부 속성들이 삭제되고, 기본 스탯, 대미지, 생명력 등으로 속성 풀이 압축되었습니다. 이는 마인크래프트 플러그인 개발 시 Enum 클래스로 관리해야 할 속성 타입의 수를 줄여주어 유지보수성을 높여줍니다.

__서버 로직을 위한 속성 분류:__



1. __기본 스탯 (Core Stats):__ 힘(Strength), 지능(Intelligence), 의지력(Willpower), 민첩성(Dexterity). 이들은 각각 방어력, 자원 회복량, 치명타 확률 등 2차 스탯에 영향을 미치는 연산 로직을 포함해야 합니다.
2. __공격적 속성 (Offensive):__ 공격 속도, 치명타 확률, 치명타 피해, 취약 피해.
3. __방어적 속성 (Defensive):__ 최대 생명력, 방어력, 속성 저항, 회피 확률.<sup>6</sup>
4. __자원/유틸리티 (Utility):__ 자원 소모량 감소, 재사용 대기시간 감소, 이동 속도.

서버의 아이템 생성기(Item Generator)는 전설 아이템 생성 시 위 카테고리 내에서 무작위로 3개의 속성을 선택하여 부여합니다. 이때 중요한 점은 __조건부 속성(예: 원거리 적에게 피해 증가)은 기본 드랍 테이블에서 제외하고, 오직 '담금질' 시스템을 통해서만 부여되도록 로직을 분리__해야 한다는 것입니다.<sup>7</sup>

__2.3 상급 속성(Greater Affix) 구현 로직__

'Loot Reborn'의 가장 큰 특징 중 하나인 상급 속성(Greater Affix, GA)은 아이템 파밍의 도파민을 담당합니다. 선조 전설 및 고유 아이템 드랍 시, 각 속성은 일정 확률로 GA로 변환됩니다.<sup>8</sup>

__구현 알고리즘:__



1. 아이템 드랍 시 각 속성(Affix)에 대해 루프를 실행합니다.
2. Random.nextFloat()를 통해 GA 발생 확률(예: 5~10%)을 체크합니다.
3. GA 당첨 시, 해당 속성의 수치를 Max_Roll * 1.5로 고정하고, NBT 태그에 is_greater_affix: true를 기록합니다.
4. 클라이언트 시각화를 위해 아이템 이름(Display Name) 뒤에 로마자 표기(I, II, III)를 추가하거나, Lore에 별도 색상(예: 굵은 붉은색)으로 표기합니다.

이 시스템은 마인크래프트 서버 경제에서 "종결급 베이스 아이템"의 가치를 창출하는 핵심 기제입니다.


---

__3. 핵심 수학 모델: 대미지 버킷과 방어 공식__

마인크래프트의 기본 대미지 공식은 (공격력 - 방어력)의 단순 차감식이거나 선형적 감소식입니다. 디아블로 4의 깊이를 구현하기 위해서는 EntityDamageByEntityEvent에서 바닐라 대미지 계산을 취소(event.setDamage(0))하고, 커스텀 공식으로 계산된 최종 값을 entity.setHealth() 또는 damage(customValue)로 적용해야 합니다.

__3.1 대미지 버킷 이론 (Damage Buckets)__

디아블로 4의 대미지 공식은 **"합연산 그룹끼리는 곱연산"**이라는 대원칙을 따릅니다. 이를 '대미지 버킷'이라 부르며, 서버 밸런싱의 핵심입니다.<sup>10</sup>

__서버 구현을 위한 대미지 공식:__

 

$$\text{Final Damage} = \text{Weapon} \times (1 + \text{MainStat}) \times (1 + \Sigma \text{Additive}) \times \Pi (1 + \text{Multiplicative}) \times \text{Crit} \times \text{Vuln} \times \text{OP}$$

각 항에 대한 상세 구현 가이드라인은 다음과 같습니다:



1. __무기 공격력 (Weapon Damage):__ 아이템에 명시된 기본 대미지 범위 내에서 랜덤 추출된 값. 스킬 계수(Skill %)는 이 값에 곱해집니다.
2. __주 스탯 (Main Stat):__ 클래스별 주 스탯(예: 야만용사의 힘)은 1 포인트당 0.1%의 독립적인 대미지 증폭을 제공합니다. 이는 별도의 승수(Multiplier)로 작용합니다.<sup>10</sup>
3. __합연산 버킷 (Additive Bucket, [+]):__ 가장 비대한 버킷입니다. "근거리 적에게 피해 +30%", "출혈 적에게 피해 +20%", "물리 피해 +15%" 등 조건이 충족되는 모든 [+] 속성들을 __모두 더한 뒤__ 1을 더해 곱합니다.
* _개발 조언:_ 무분별한 인플레이션을 막기 위해 이 버킷의 효율은 점감(Diminishing Returns)합니다. 이미 합연산 합계가 1000%라면, 추가 50%는 전체 딜량의 5% 상승에 불과함을 인지하고 수치를 설계해야 합니다.

4.              __곱연산 버킷 (Global Multipliers, [x]):__ 주로 전설 위상(Aspect)이나 파라곤 노드에서 "피해가 x20% 증가"라고 명시된 옵션들입니다. 이들은 각각 독립적으로 곱해지므로 밸런스 파괴의 주범이 될 수 있어 신중히 배포해야 합니다.

5.              __치명타 및 취약 (Crit & Vuln):__



* __치명타:__ 발동 시 1.5 * (1 + 추가 치명타 피해).<sup>10</sup> 시즌 4부터 치명타 피해 수치 자체는 합연산 버킷으로 이동했으나, 기본 1.5배수는 여전히 곱연산으로 작용함에 유의해야 합니다.
* __취약(Vulnerable):__ 대상이 취약 상태일 때 1.2 * (1 + 추가 취약 피해). 역시 기본 1.2배수는 곱연산입니다.

__3.2 방어력 공식과 캡 (Armor Formula)__

디아블로 4의 방어력(Armor)은 물리 피해에 대해서만 작동하며, 원소 저항과는 별개로 계산됩니다. 특히 시즌 4에서는 몬스터 레벨에 따른 변동성을 제거하고, **플레이어 레벨 100 기준 방어력 9,230에서 물리 피해 감소율(DR)이 85%로 최대치(Cap)**에 도달하도록 변경되었습니다.<sup>13</sup>

__마인크래프트 적용 공식:__

 

$$\text{Physical DR} = \min\left(0.85, \frac{\text{PlayerArmor}}{\text{ArmorCapConstant}}\right)$$



* ArmorCapConstant: 서버의 만렙 기준에 맞춰 조정해야 합니다. 디아블로 4와 동일하게 간다면 9,230으로 설정합니다.
* 플레이어의 방어력이 9,230을 초과하더라도 물리 피해 감소율은 85%를 넘지 못합니다. 이 잉여 방어력은 낭비되므로, 플레이어는 방어력을 딱 캡까지만 맞추고 나머지는 생명력이나 회피로 돌리도록 유도해야 합니다.

저항 시스템 (Resistances):

화염, 냉기, 번개, 독, 암흑 저항은 기본적으로 70%에서 캡이 걸리며, 특정 아이템이나 효과로 최대 85%까지 확장 가능합니다. 마인크래프트에서는 EntityDamageEvent의 DamageCause를 감지하여(예: LAVA는 화염, MAGIC은 암흑 등) 해당 저항력을 적용해야 합니다.


---

__4. 데이터 엔지니어링: NBT와 PersistentDataContainer__

복잡한 속성 데이터를 마인크래프트 아이템에 저장하기 위해 단순한 Lore 파싱은 지양해야 합니다. 성능과 데이터 무결성을 위해 Spigot API의 PersistentDataContainer (PDC)를 활용한 직렬화 방식이 필수적입니다.<sup>16</sup>

__4.1 아이템 데이터 스키마 (JSON 모델)__

각 아이템은 아래와 같은 구조의 JSON 데이터를 PDC 내에 문자열 혹은 바이트 배열 형태로 저장해야 합니다.

 

JSON

 

{ \
   "uuid": "550e8400-e29b-41d4-a716-446655440000", \
   "template_id": "ancestral_sword_var3", \
   "item_power": 925, \
   "required_level": 80, \
   "durability": 100, \
   "tempering": { \
     "durability": 5, \
     "bricked": false \
   }, \
   "masterworking": { \
     "rank": 0, \
     "crit_indices": \
   }, \
   "affixes": \
 } \
 \
 \


__4.2 PDC 구현 전략__



* __NamespacedKey 활용:__ new NamespacedKey(plugin, "diablo_data")를 키로 사용하여 전체 JSON을 저장하는 방식이 가장 유연합니다. 개별 스탯을 각각의 키로 저장할 경우(예: diablo_strength, diablo_int), NBT 태그가 너무 많아져 네트워크 패킷 오버헤드가 발생할 수 있습니다.
* __캐싱(Caching):__ 전투 시마다 NBT를 파싱하는 것은 연산 비용이 높습니다. 플레이어가 아이템을 장착(Equip)하거나 접속할 때, 해당 아이템의 능력치를 파싱하여 HashMap&lt;StatType, Double> 형태의 세션 데이터로 메모리에 로드하고, 전투 시에는 메모리 데이터를 참조해야 합니다.<sup>18</sup>


---

__5. 시스템 구현: 담금질(Tempering)과 명품화(Masterworking)__

디아블로 4 시즌 4의 핵심 루프인 '대장간(Blacksmith)' 시스템을 구현합니다.

__5.1 담금질 시스템: 리스크와 리턴__

담금질은 전설 아이템에 2개의 추가 속성을 부여하는 과정입니다. 이때 사용되는 것이 '담금질 설명서(Tempering Manual)'입니다.

담금질 매뉴얼 카테고리 및 데이터베이스 19:

서버는 다음과 같은 카테고리별 매뉴얼 데이터를 보유해야 합니다. 선조 아이템은 서로 다른 카테고리의 속성 2개를 부여할 수 있습니다 (예: 무기 1개 + 공격 1개).


<table>
  <tr>
   <td><strong>카테고리</strong>
   </td>
   <td><strong>적용 가능 부위</strong>
   </td>
   <td><strong>예시 매뉴얼 및 효과</strong>
   </td>
  </tr>
  <tr>
   <td><strong>무기 (Weapon)</strong>
   </td>
   <td>무기
   </td>
   <td><strong>원소 쇄도(Elemental Surge):</strong> 무기 공격 시 일정 확률로 화염/냉기 피해 등 추가 발동.
<p>
 
<p>
<strong>투사체 복사:</strong> 뼈 창 등 특정 스킬 투사체가 2번 발사될 확률.
   </td>
  </tr>
  <tr>
   <td><strong>공격 (Offensive)</strong>
   </td>
   <td>무기, 장갑, 목걸이, 반지
   </td>
   <td><strong>자연의 기교(Natural Finesse):</strong> 근거리/원거리 적에게 주는 피해 증가.
<p>
 
<p>
<strong>혈기(Blood Finesse):</strong> 피 기술 피해 증가 (강령술사).
   </td>
  </tr>
  <tr>
   <td><strong>방어 (Defensive)</strong>
   </td>
   <td>투구, 가슴, 바지, 목걸이
   </td>
   <td><strong>세속의 인내(Worldly Endurance):</strong> 총 방어도 %, 최대 생명력 %, 회피 확률.
   </td>
  </tr>
  <tr>
   <td><strong>유틸리티 (Utility)</strong>
   </td>
   <td>투구, 가슴, 장갑, 신발
   </td>
   <td><strong>군중 제어(Crowd Control):</strong> 기절/빙결 지속 시간 증가, 범위 증가.
   </td>
  </tr>
  <tr>
   <td><strong>기동성 (Mobility)</strong>
   </td>
   <td>신발, 목걸이
   </td>
   <td><strong>이동:</strong> 이동 속도 증가, 회피 재사용 대기시간 감소.
   </td>
  </tr>
  <tr>
   <td><strong>자원 (Resource)</strong>
   </td>
   <td>반지, 목걸이
   </td>
   <td><strong>자원:</strong> 자원 생성량 증가, 행운의 적중 시 자원 회복.
   </td>
  </tr>
</table>


브릭(Bricking) 메커니즘 구현 22:

담금질의 긴장감은 '실패 가능성'에서 옵니다.



1. 아이템 생성 시 temper_durability(기본 5)를 부여합니다.
2. 플레이어가 매뉴얼을 사용해 담금질을 시도할 때마다 이 수치를 1씩 차감합니다.
3. 원하는 옵션이 나오지 않았는데 내구도가 0이 되면, 더 이상 담금질이 불가능해집니다(Bricked). 이 상태의 아이템은 스펙 업이 멈추므로, 플레이어는 새로운 베이스 아이템을 파밍해야 합니다.

__5.2 명품화 시스템: 엔드게임 성장__

명품화는 담금질이 완료된 아이템의 성능을 12단계에 걸쳐 강화하는 시스템입니다.

단계별 강화 로직 <sup>23</sup>:



* __일반 단계 (1-3, 5-7, 9-11):__ 아이템의 _모든_ 속성(기본 + 담금질 포함)이 현재 수치의 5%만큼 증가합니다.
* __크리티컬 단계 (4, 8, 12):__ 5% 전체 증가 대신, __단 하나의 속성__이 무작위로 선정되어 __25%__ 대폭 증가합니다. 이 '저격' 성공 여부가 엔드게임 파밍의 목표가 됩니다.

재료 비용 테이블 (마인크래프트 서버 경제용) <sup>23</sup>:


<table>
  <tr>
   <td><strong>명품화 단계</strong>
   </td>
   <td><strong>필요 재료 (디아블로)</strong>
   </td>
   <td><strong>마인크래프트 구현 제안</strong>
   </td>
   <td><strong>획득처 (구현 필요)</strong>
   </td>
  </tr>
  <tr>
   <td><strong>1 - 4</strong>
   </td>
   <td>옵두사이트 (Obducite)
   </td>
   <td>희귀 광석/수정
   </td>
   <td>나락(The Pit) 1~30층
   </td>
  </tr>
  <tr>
   <td><strong>5 - 8</strong>
   </td>
   <td>잉골리스 (Ingolith)
   </td>
   <td>강화된 금속 주괴
   </td>
   <td>나락 31~60층
   </td>
  </tr>
  <tr>
   <td><strong>9 - 12</strong>
   </td>
   <td>니스아이언 (Neathiron)
   </td>
   <td>지옥벼림 철괴
   </td>
   <td>나락 61층 이상
   </td>
  </tr>
</table>


재료 변환: 상위 재료는 하위 재료로 1:3 비율로 교환 가능하도록 NPC를 구현해야 합니다.

초기화: 명품화 결과가 마음에 들지 않을 경우, 막대한 골드와 재료를 지불하고 0단계로 초기화하는 기능(Reset)을 제공해야 합니다.


---

__6. 전리품 생성 알고리즘: 스마트 룻과 고유 장비__

디아블로 4의 아이템 드랍은 완전 무작위가 아닌, 플레이어의 직업과 상황을 고려한 '스마트 룻(Smart Loot)' 시스템을 따릅니다.<sup>26</sup>

__6.1 클래스 가중치 적용 (Class Weighting)__

EntityDeathEvent 발생 시 전리품 생성기는 다음 로직을 따라야 합니다:



1. __플레이어 클래스 확인:__ 킬을 낸 플레이어가 '강령술사'인가?
2. __아이템 타입 필터링:__ 전체 무기 리스트 중 강령술사가 착용 가능한(낫, 한손검, 방패 등) 아이템을 85% 확률로 선택합니다. 나머지 15%는 타 직업 아이템을 드랍하여 부캐릭터 육성을 유도합니다.
3. __주 스탯 보정:__ 강령술사에게 드랍되는 아이템은 '지능' 스탯이 붙을 확률을 대폭 높이고, '힘' 스탯 등은 배제합니다.

__6.2 무기별 고유 임플리싯(Implicit) 스탯 구현__

모든 무기는 태생적으로 고유한 고정 효과를 가집니다. 이는 마인크래프트 아이템의 재질이나 종류에 따라 NBT로 고정 부여해야 합니다.<sup>6</sup>

__무기 타입별 임플리싯 데이터:__



* __검 (Sword):__ 치명타 피해 증가 (Crit Damage)
* __도끼 (Axe):__ 건강한 적(체력 80% 이상)에게 주는 피해 증가 (Dmg vs Healthy)
* __철퇴 (Mace):__ 제압 피해 증가 (Overpower Damage)
* __단검 (Dagger):__ 근거리 적에게 주는 피해 증가 (Dmg to Close)
* __활 (Bow):__ 원거리 적에게 주는 피해 증가 (Dmg to Distant)
* __쇠뇌 (Crossbow):__ 취약 피해 증가 (Vulnerable Damage)
* __지팡이 (Staff):__ 군중 제어 대상에게 피해 증가 (Dmg to CC)
* __마법봉 (Wand):__ 행운의 적중 확률 증가 (Lucky Hit Chance)

이 임플리싯 스탯은 랜덤하게 붙는 어픽스와 별개로 작동하며, 아이템 위력에 따라 그 수치가 스케일링되어야 합니다.


---

__7. 결론 및 개발 로드맵__

디아블로 4 'Loot Reborn' 시스템을 마인크래프트에 이식하는 것은 단순한 플러그인 제작을 넘어선 하나의 독자적인 게임 엔진을 구축하는 과정입니다. 바닐라 대미지 공식을 폐기하고, NBT 기반의 객체 지향적 아이템 데이터를 구축하며, 담금질과 명품화라는 경제 시스템을 연결해야 합니다.

__성공적인 서버 런칭을 위한 단계별 개발 로드맵:__



1. __Phase 1 (Core Engine):__ EntityDamageByEntityEvent를 캔슬하고 커스텀 대미지 공식을 적용하는 전투 엔진 개발. 방어력 캡(85%) 로직 구현.
2. __Phase 2 (Itemization):__ JSON 기반의 아이템 스키마 설계 및 PDC 연동. 베이스 아이템 및 상급 속성(GA) 생성기 구현.
3. __Phase 3 (Crafting UI):__ 대장간 GUI 개발. 담금질(매뉴얼 데이터베이스) 및 명품화(재료 소모 및 4/8/12 크리티컬) 로직 구현.
4. __Phase 4 (Content):__ '나락(The Pit)' 던전 시스템 구현 및 재료 드랍 테이블 구성.

이 보고서에 제시된 수치와 공식, 데이터 구조는 디아블로 4 시즌 4의 실제 메커니즘을 정밀하게 분석한 결과이며, 이를 준수할 때 마인크래프트 내에서 가장 완성도 높은 핵 앤 슬래시 경험을 제공할 수 있을 것입니다.